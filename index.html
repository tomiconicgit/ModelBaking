<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <title>Titan Forge</title>

  <!-- PWA manifest (inline for simplicity) -->
  <link rel="manifest" href='data:application/manifest+json,{
    "name":"Titan Forge",
    "short_name":"TitanForge",
    "start_url":".",
    "display":"standalone",
    "background_color":"#101318",
    "theme_color":"#101318",
    "icons":[
      {"src":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMAAAADACAYAAABS3GwHAAAAaklEQVR4nO3BMQEAAADCoPVPbQ0PoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACeDc1wAAGaT44gAAAAAElFTSuQmCC","sizes":"192x192","type":"image/png"}
    ]
  }' />

  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Titan Forge" />
  <meta name="theme-color" content="#101318" />

  <style>
    :root{
      --bg:#101318; --panel-bg:#161a21;
      --fg:#e6eef6; --fg-light:#8899aa;
      --primary:#0aa2ff; --primary-2:#33b3ff;
      --accent:#ff4757; --border:#2a2f36; --border-2:#4a4f56;
      --viewer-h: clamp(260px, 55vh, 70vh);
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
    body{overflow:hidden;-webkit-font-smoothing:antialiased}
    /* disable accidental zooms on iOS */
    *{touch-action:manipulation}
    #app{display:flex;flex-direction:column;height:100vh;height:100dvh;padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left)}
    #viewer3d{height:var(--viewer-h);position:relative}
    #viewer3d canvas{display:block;width:100%;height:100%}
    #hud{position:absolute;left:10px;top:10px;background:#0009;border:1px solid var(--border);border-radius:8px;padding:6px 8px;font:12px/1.3 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;color:#cfe8ff;pointer-events:none}
    #panel-container{flex:1;background:var(--panel-bg);border-top:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden}
    #bottom-navbar{display:flex;border-bottom:1px solid var(--border);overflow-x:auto;gap:4px;padding:4px}
    .nav-btn{flex:0 0 auto;padding:14px 18px;border:none;background:#1b2027;color:var(--fg-light);cursor:pointer;font-size:1rem;border-radius:10px}
    .nav-btn.active{color:#fff;background:#0b1722;border:1px solid var(--border)}
    #panel-content{flex:1;overflow:auto}
    .panel{padding:12px} .hidden{display:none!important}

    /* Touch-friendly controls */
    .button{background:var(--primary);border:none;color:#fff;border-radius:12px;padding:14px 18px;font-size:1rem;min-height:48px}
    .button.ghost{background:#1b2027;border:1px solid var(--border);color:var(--fg)}
    .button.accent{background:var(--accent)}
    .button:disabled{opacity:.5}
    .button-group{display:flex;flex-wrap:wrap;gap:.75rem}

    .slider-row{display:grid;grid-template-columns:52px 48px 1fr 110px 48px;gap:.7rem;align-items:center;margin-bottom:.6rem}
    .slider-row label{justify-self:center;font-weight:700;color:var(--fg-light)}
    .slider-row input[type=range]{height:44px}
    .nudge{height:48px;border-radius:10px;border:1px solid var(--border-2);background:#1b2027;color:var(--fg);font-size:1.2rem}
    .num{height:48px;border-radius:10px;border:1px solid var(--border);background:#232933;color:var(--fg);font-size:1rem;padding:0 10px}

    /* Modals */
    .modal-overlay{position:fixed;inset:0;background:#000a;display:flex;align-items:center;justify-content:center;z-index:1000}
    .modal{background:#171b22;border:1px solid var(--border);border-radius:16px;max-width:520px;width:92%;max-height:85vh;overflow:auto;padding:16px}

    /* Bootstrap splash */
    #bootstrap{position:fixed;inset:0;background:#000;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:18px;z-index:2000}
    #brand{font-weight:900;font-size:38px;letter-spacing:2px;color:#fff;opacity:0;transform:translateY(8px);transition:opacity .6s ease, transform .6s ease}
    #brand.show{opacity:1;transform:none}
    #spin{width:54px;height:54px;border-radius:50%;border:5px solid #fff3;border-top-color:#fff;animation:sp 1s linear infinite}
    #spin.error{border-color:#ff334455;border-top-color:#ff3344;box-shadow:0 0 20px #ff3344}
    #boot-msg{color:#9fb6ff;font:14px/1.4 ui-monospace,monospace}
    #boot-err{color:#ffb6c1;white-space:pre-wrap;max-width:min(90vw,680px);display:none}
    #copy-err{display:none}
    @keyframes sp{to{transform:rotate(360deg)}}
  </style>

  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.168.0/build/three.module.js",
      "three/addons/": "https://unpkg.com/three@0.168.0/examples/jsm/"
    }
  }
  </script>
</head>
<body>
  <!-- Bootstrap splash -->
  <div id="bootstrap">
    <div id="brand">TITAN FORGE</div>
    <div id="spin"></div>
    <div id="boot-msg">Loading…</div>
    <div id="boot-err"></div>
    <button id="copy-err" class="button ghost">Copy Error</button>
  </div>

  <div id="app" class="hidden" role="application">
    <div id="viewer3d"><div id="hud">tile: (0,0) • mode: centers • world: (0.00, 0.00)</div></div>

    <div id="panel-container">
      <nav id="bottom-navbar">
        <button class="nav-btn active" data-panel="dashboard-panel">Dashboard</button>
        <button class="nav-btn" data-panel="grid-panel">Grid</button>
        <button class="nav-btn" data-panel="transform-panel">Transform</button>
        <button class="nav-btn" data-panel="mesh-panel">Meshes</button>
        <button class="nav-btn" data-panel="texture-panel">Textures</button>
        <button class="nav-btn" data-panel="tabs-panel">Tabs</button>
      </nav>
      <div id="panel-content">
        <section id="dashboard-panel" class="panel"></section>
        <section id="grid-panel" class="panel hidden"></section>
        <section id="transform-panel" class="panel hidden"></section>
        <section id="mesh-panel" class="panel hidden"></section>
        <section id="texture-panel" class="panel hidden"></section>
        <section id="tabs-panel" class="panel hidden"></section>
      </div>
    </div>

    <!-- Export modal -->
    <div id="export-modal" class="modal-overlay hidden">
      <div class="modal">
        <h3 style="margin:0 0 10px">Export Model</h3>
        <p>Select the model to export. All edits are included.</p>
        <div style="display:grid;gap:10px">
          <label>Model
            <select id="export-model-select" style="width:100%;height:44px;border-radius:10px;border:1px solid var(--border);background:#232933;color:#fff;padding:0 10px"></select>
          </label>
          <label>New filename (.glb)
            <input id="export-filename-input" type="text" style="width:100%;height:44px;border-radius:10px;border:1px solid var(--border);background:#232933;color:#fff;padding:0 10px" placeholder="my_edited_model">
          </label>
        </div>
        <div class="button-group" style="margin-top:14px">
          <button id="cancel-export-btn" class="button ghost">Cancel</button>
          <button id="confirm-export-btn" class="button">Export</button>
        </div>
      </div>
    </div>

    <!-- Bone connect modal -->
    <div id="bone-connect-modal" class="modal-overlay hidden">
      <div class="modal">
        <h3 style="margin:0 0 10px">Connect Mesh to Bone</h3>
        <p>Parent mesh <strong id="bone-connect-mesh-name"></strong> to a target bone.</p>
        <div style="display:grid;gap:10px">
          <label>Target Model
            <select id="bone-connect-target-model" style="width:100%;height:44px;border-radius:10px;border:1px solid var(--border);background:#232933;color:#fff;padding:0 10px"></select>
          </label>
          <label>Target Bone
            <select id="bone-connect-target-bone" style="width:100%;height:44px;border-radius:10px;border:1px solid var(--border);background:#232933;color:#fff;padding:0 10px"></select>
          </label>
        </div>
        <div class="button-group" style="margin-top:14px">
          <button id="cancel-bone-connect-btn" class="button ghost">Cancel</button>
          <button id="confirm-bone-connect-btn" class="button">Connect</button>
        </div>
      </div>
    </div>

    <!-- hidden file inputs -->
    <input type="file" id="model-input" accept=".glb,.gltf,model/gltf-binary,model/gltf+json" multiple style="position:fixed;left:-9999px;opacity:0" />
    <input type="file" id="animation-input" accept=".glb,.gltf" style="position:fixed;left:-9999px;opacity:0" />
    <input type="file" id="texture-input" accept="image/*" style="position:fixed;left:-9999px;opacity:0" />
  </div>

  <script type="module" src="./bootstrap.js"></script>
</body>
</html>